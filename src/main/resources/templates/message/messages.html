<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head th:replace="~{fragments :: head}"></head>

<body class="m-2 gradientBg">
<di>TEST</di>
<br/>
<div class="color3 container w-75 rounded-top p-1">
    <div class="color2 container rounded p-4">
        <div class="color1 container rounded p-4">
            <div class="row">

                <div class="color7 container rounded p-4 col mx-1">


                <h1>Start a New Conversation</h1>

                <form method="post" role="form"
                      th:action="@{../message/create}"
                      th:object="${createMessageDTO}">
                    <div class="form-group">
                        <div class="dropdown">
                        <label>Message Receiver:
                            <input th:field="*{receiverUsername}" class="form-control" id="input-search-box" autocomplete="off" />
                        </label>
                        <div class="results">
                        </div>
                    </div>
                        <p class="error" th:errors="*{receiverUsername}"></p>
                    </div>

                    <input type="hidden" id="suggestionsUrl" th:value="${suggestionsUrl}" />

                    <div class="form-group">
                        <label>Subject of the message:
                            <input th:field="*{messageSubject}" class="form-control">
                        </label>
                        <p class="error" th:errors="*{messageSubject}"></p>
                    </div>
                    <div class="form-group">

                        <p class="error" th:errors="*{text}"></p>
                        <label><h5>Message:</h5>
                            <br/>
                            <textarea th:field="*{text}" name="text" rows="5" cols="50" />
                        </label>
                        <br/>
                    </div>
                    <input type="submit" value="Send Message" class="btn btn-primary">
                </form>
            </div>

            <div class="color7 container rounded p-4 col mx-1">

                <h2 class="text-center">Your Conversations</h2>

<!--                <a href="/message/create">Click here to message someone new (Create new MessageChain)</a>-->
<!--                <br/>-->
        <div th:each="messageChain : ${messageChainList}" class="p-1">

            <div class="color6 container rounded p-1">
                <div class="color7 container rounded p-2">

            <h5>Message Subject: <a th:href="'/message/message?messageChainId=' + ${messageChain.id}" th:text="${messageChain.messageChainSubject}"></a></h5>
            <h5>with:
            <!--            todo: update link to user profile page.-->
            <th:block th:unless="${userEntity.id.equals(messageChain.userEntityList[0].id)}">
                <a th:href="'/profile/PUTUSERPROFILEHERE?username=' + ${messageChain.userEntityList[0].username}">
                    <span th:text="${messageChain.userEntityList[0].username}"></span>
                </a>
            </th:block>
            <!--            todo: update link to user profile page.-->
                <th:block th:unless="${userEntity.id.equals(messageChain.userEntityList[1].id)}">
                    <a th:href="'/profile/PUTUSERPROFILEHERE?username=' + ${messageChain.userEntityList[1].username}">
                        <span th:text="${messageChain.userEntityList[1].username}"></span>
                    </a>
                </th:block>
            </h5>

            <div class="p-2">
            <p>Most Recent Message:
                <div class="color5 rounded w-50 p-2">
                <span th:text="${messageChain.messages[messageChain.messages.size() - 1].text}"></span></p>
                <p><span th:text="${messageChain.messages[messageChain.messages.size() - 1].userEntity.username}"></span>:</p>
                </div>
            </div>

        </div>
        </div></div>
            </div>
            </div>
    </div></div>
</div>
</div>
<script th:src="@{/js/fetchSuggestions.js}"></script>
<th:block th:replace="~{fragments :: endingScripts}"></th:block>
</body>

<footer style="font-size: large" class="panel-footer">
    <div class="container color9 w-75 p-1 rounded-bottom">
    <div class="color9 p-1">
    <!--    sets the pagination menu / control-->
    <nav aria-label="Conversations Page Navigation Menu">
        <ul class="pagination pagination-lg justify-content-center">

            <li th:unless="${currentPage == 1}" class="page-item"><a class="page-link" th:href="@{'/message/messages/page/1'}">First</a></li>
            <li th:unless="${currentPage == 1}" class="page-item"><a class="page-link" th:href="@{'/message/messages/page/' + ${currentPage - 1}}">Previous</a></li>


<!--            if total number of pages is less than the paginationMenuTotalVisible set in controller -->
            <th:block th:if="${totalPages <= paginationMenuTotalVisible}">
                <th:block th:each="i: ${#numbers.sequence(1, totalPages)}">

<!--            Sets active status for the current page-->
                    <th:block th:if="${currentPage == i}">
                        <li class="page-item active">
                            <a class="page-link" th:href="@{'/message/messages/page/' + ${i}}">[[${i}]]</a>
                        </li>
                    </th:block>
                    <th:block th:unless="${currentPage == i}">
                        <li class="page-item">
                            <a class="page-link" th:href="@{'/message/messages/page/' + ${i}}">[[${i}]]</a>
                        </li>
                    </th:block>
                </th:block>
            </th:block>

<!--            if total number of pages is more than the paginationMenuTotalVisible set in controller -->
            <th:block th:if="${totalPages > paginationMenuTotalVisible}">

<!--                If the currentPage is within paginationMenuSplitSidesVisible from the beginning or paginationMenuSplitSidesVisible from the end-->
                <th:block th:if="${currentPage <= paginationMenuSplitSidesVisible || currentPage >= totalPages - (paginationMenuSplitSidesVisible - 1)}">

                    <th:block th:each="i: ${#numbers.sequence(1, paginationMenuSplitSidesVisible)}">
<!--                Sets active status for the current page-->
                        <th:block th:if="${currentPage == i}">
                            <li class="page-item active">
                            <a class="page-link" th:href="@{'/message/messages/page/' + ${i}}">[[${i}]]</a>
                            </li>
                        </th:block>
                        <th:block th:unless="${currentPage == i}">
                            <li class="page-item">
                                <a class="page-link" th:href="@{'/message/messages/page/' + ${i}}">[[${i}]]</a>
                            </li>
                        </th:block>

                    </th:block>

                    <li class="page-item">
                        <a class="page-link" th:href="@{'/message/messages/page/' + ${paginationMenuSplitSidesVisible + 1}}">...</a>
                    </li>

                    <th:block th:each="i: ${#numbers.sequence(totalPages - (paginationMenuSplitSidesVisible - 1), totalPages)}">
<!--                Sets active status for the current page-->
                        <th:block th:if="${currentPage == i}">
                            <li class="page-item active">
                                <a class="page-link" th:href="@{'/message/messages/page/' + ${i}}">[[${i}]]</a>
                            </li>
                        </th:block>
                        <th:block th:unless="${currentPage == i}">
                            <li class="page-item">
                                <a class="page-link" th:href="@{'/message/messages/page/' + ${i}}">[[${i}]]</a>
                            </li>
                        </th:block>
                    </th:block>
                </th:block>

<!--                If current page is more than paginationMenuSplitSidesVisible from the beginning or end-->
                <th:block th:if="${currentPage > paginationMenuSplitSidesVisible && currentPage < totalPages - (paginationMenuSplitSidesVisible - 1)}">
                    <th:block th:each="i: ${#numbers.sequence(currentPage - paginationMenuSplitSidesVisible, currentPage - 1)}">
                            <li class="page-item">
                                <a class="page-link" th:href="@{'/message/messages/page/' + ${i}}">[[${i}]]</a>
                            </li>
                    </th:block>
                    <li class="page-item active">
                        <a class="page-link" th:href="@{'/message/messages/page/' + ${currentPage}}">
                            <span th:text="${currentPage}"></span>
                        </a>
                    </li>
                    <th:block th:each="i: ${#numbers.sequence(currentPage + 1, currentPage + paginationMenuSplitSidesVisible)}">
                        <li class="page-item">
                            <a class="page-link" th:href="@{'/message/messages/page/' + ${i}}">[[${i}]]</a>
                        </li>
                    </th:block>
                </th:block>
            </th:block>
            <li th:unless="${currentPage == totalPages}" class="page-item"><a class="page-link" th:href="@{'/message/messages/page/' + ${currentPage + 1}}">Next</a></li>
            <li th:unless="${currentPage == totalPages}" class="page-item"><a class="page-link" th:href="@{'/message/messages/page/' + ${totalPages}}">Last</a></li>
        </ul>
    </nav>
    </div></div>
</footer>
</html>